<script>
var DEFAULT_LOCALE = '/de/'
var LOCALES = [DEFAULT_LOCALE, '/en/'];
var ENG_INDEX_HREF = '/en/happening-now';
var DEU_INDEX_HREF = '/';

var LOCALE_BUTTON_ID = 'language-toggle';
var LOCALE_BUTTON = '<a id="' + LOCALE_BUTTON_ID + '"></a>';
var DESKTOP_MENU_ITEM_SELECTOR = '.Header-nav-folder-title';
var MOBILE_MENU_ITEM_SELECTOR = '.Mobile-overlay-nav-item';
var PRIMARY_NAV_SELECTOR = '.Header-nav--primary';

var WOLF_NODES = {
    getPrimaryNav: function () {
        return document.querySelector(PRIMARY_NAV_SELECTOR);
    },

    getNodes: function (selector) {
        return Array.from(document.querySelectorAll(selector));
    },

    getMobileMenuItems: function () {
        return this.getNodes(MOBILE_MENU_ITEM_SELECTOR);
    },

    getDesktopMenuItems: function () {
        return this.getNodes(DESKTOP_MENU_ITEM_SELECTOR);
    },

    getLocaleButton: function () {

        return document.getElementById(LOCALE_BUTTON_ID);
    },

    getPageTitle: function () {
        return document.querySelector('.Header-branding');
    }
};

var WOLF_LOCALIZE_VIEWS = {

    showOrHideMenuItem: function (menuItem, show) {
        if (menuItem) menuItem.style.display = show ? 'inline-block' : 'none';
    },

    updateTitleHREF: function (href) {
        WOLF_NODES.getPageTitle().href = href
    },

    renderLocaleButton: function(innerText, href) {
        var el = WOLF_NODES.getLocaleButton();
        if (!el) document.body.insertAdjacentHTML('afterbegin', LOCALE_BUTTON);
        el = WOLF_NODES.getLocaleButton();
        el.innerText = innerText;
        el.href = href;
    }
};

var WOLF_MENU_VIEWS = {
    removeLinksFromMenuItems: function () {
        WOLF_NODES.getDesktopMenuItems()
        .forEach(function (item) {
            item.removeAttribute('href')
        })
    }
};

var WOLF_LOCALIZE_ACTIONS = {

    getLocale: function () {
        return document.location.pathname.substring(0, 4);
    },

    stripOriginFromPath: function (path) {
        return path.replace(document.location.origin, '');
    },

    doesLocaleExist: function () {
        const localeExists = LOCALES.some((item) => item === this.getLocale());
        return localeExists;
    },

    doesHREFBelongToLocale: function (href) {
        const locale = this.doesLocaleExist() ? this.getLocale() : DEFAULT_LOCALE;
        return this.stripOriginFromPath(href)
            .indexOf(locale) === 0;
    },

    localizeDesktopMenu: function () {
        var self = this;
        WOLF_NODES.getDesktopMenuItems()
        .map(function (menuItem) {
            if (!menuItem) return null
            var show = self.doesHREFBelongToLocale(menuItem.href);
            return WOLF_LOCALIZE_VIEWS.showOrHideMenuItem(menuItem.parentNode, show);
        });
    },

    localizeMobileMenu: function () {
        var self = this;
        WOLF_NODES.getMobileMenuItems().map(function (menuItem) {
            if (menuItem.href && self.doesHREFBelongToLocale(menuItem.href)) {
                return WOLF_LOCALIZE_VIEWS.showOrHideMenuItem(menuItem, true);
            }
            var folderHREF = menuItem.getAttribute('data-controller-folder-toggle');
            var folderBelongs = self.doesHREFBelongToLocale('/' + folderHREF);
            return WOLF_LOCALIZE_VIEWS.showOrHideMenuItem(menuItem, folderBelongs);
        });
    },

    currentLocaleIsGerman: function () {
        return this.getLocale() === '/de/' || this.getLocale() === '/';
    },

    localizeLocaleButton: function() {
        if (this.currentLocaleIsGerman()) {
            return WOLF_LOCALIZE_VIEWS.renderLocaleButton('English', ENG_INDEX_HREF);
        }

        return WOLF_LOCALIZE_VIEWS.renderLocaleButton('Deutsch', DEU_INDEX_HREF);
    },

    localizeTitleHREF: function() {
        const href = this.currentLocaleIsGerman() ? DEU_INDEX_HREF : ENG_INDEX_HREF;
        WOLF_LOCALIZE_VIEWS.updateTitleHREF(href);
    },

    localizeSite: function () {
        this.localizeDesktopMenu();
        this.localizeMobileMenu();
        this.localizeLocaleButton();
        this.localizeTitleHREF();
    },

    bindToNavChanges: function () {
        var observer = new MutationObserver(this.localizeSite.bind(this));
        observer.observe(WOLF_NODES.getPrimaryNav(), {
            attributes: true, childList: true, characterData: true
        });
    },

    initialize: function () {
        this.localizeSite();
        this.bindToNavChanges();
    }
};

var WOLF_APP = {
    initialize: function () {
        WOLF_LOCALIZE_ACTIONS.initialize();
        WOLF_MENU_VIEWS.removeLinksFromMenuItems();
    }
};

WOLF_APP.initialize();
</script>