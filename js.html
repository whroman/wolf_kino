<script>
var DEFAULT_LOCALE = '/de/'
var LOCALES = [DEFAULT_LOCALE, '/en/'];
var DESKTOP_MENU_ITEM_SELECTOR = '.Header-nav-folder-title';
var MOBILE_MENU_ITEM_SELECTOR = '.Mobile-overlay-nav-item';
var PRIMARY_NAV_SELECTOR = '.Header-nav--primary';

var ENG_INDEX_HREF = '/en/happening-now';
var DEU_INDEX_HREF = '/de/happening-now';
var LOCALE_BUTTON_ID = 'language-toggle';
var LOCALE_BUTTON = '<a id="' + LOCALE_BUTTON_ID + '"></a>';


var WOLF_LOCALIZE_VIEWS = {
    getPrimaryNavNode: function () {
        return document.querySelector(PRIMARY_NAV_SELECTOR);
    },

    getMobileMenuItemNodes: function () {
        return Array.from(document.querySelectorAll(
            MOBILE_MENU_ITEM_SELECTOR
        ));
    },

    getDesktopMenuItemNodes: function () {
        return Array.from(document.querySelectorAll(
            DESKTOP_MENU_ITEM_SELECTOR
        ));
    },

    showOrHideMenuItem: function (menuItem, show) {
        if (menuItem) menuItem.style.display = show ? 'inline-block' : 'none';
    },


    updateTitleHREF: function (href) {
        var el = document.querySelector('.Header-branding');
        el.href = href
    },

    getLocaleButtonNode: function () {
        return document.getElementById(LOCALE_BUTTON_ID);
    },

    renderLocaleButton: function(innerText, href) {
        var el = this.getLocaleButtonNode();
        if (!el) document.body.insertAdjacentHTML('afterbegin', LOCALE_BUTTON);
        el = this.getLocaleButtonNode();
        el.innerText = innerText;
        el.href = href;
    }
};

var WOLF_LOCALIZE = {

    getLocale: function () {
        return document.location.pathname.substring(0, 4);
    },

    stripOriginFromPath: function (path) {
        return path.replace(document.location.origin, '');
    },

    doesLocaleExist: function () {
        const localeExists = LOCALES.some((item) => item === this.getLocale());
        return localeExists;
    },

    doesHREFBelongToLocale: function (href) {
        const locale = this.doesLocaleExist() ? this.getLocale() : DEFAULT_LOCALE;
        return this.stripOriginFromPath(href)
            .indexOf(locale) === 0;
    },

    localizeDesktopMenu: function () {
        var self = this;
        WOLF_LOCALIZE_VIEWS.getDesktopMenuItemNodes()
        .map(function (menuItem) {
            if (!menuItem) return null
            var show = self.doesHREFBelongToLocale(menuItem.href);
            return WOLF_LOCALIZE_VIEWS.showOrHideMenuItem(menuItem.parentNode, show);
        });
    },

    localizeMobileMenu: function () {
        var self = this;
        WOLF_LOCALIZE_VIEWS.getMobileMenuItemNodes().map(function (menuItem) {
            if (menuItem.href && self.doesHREFBelongToLocale(menuItem.href)) {
                return WOLF_LOCALIZE_VIEWS.showOrHideMenuItem(menuItem, true);
            }
            var folderHREF = menuItem.getAttribute('data-controller-folder-toggle');
            var folderBelongs = self.doesHREFBelongToLocale('/' + folderHREF);
            return WOLF_LOCALIZE_VIEWS.showOrHideMenuItem(menuItem, folderBelongs);
        });
    },

    currentLocaleIsGerman: function () {
        return this.getLocale() === '/de/';
    },

    localizeLocaleButton: function() {
        if (this.currentLocaleIsGerman()) {
            return WOLF_LOCALIZE_VIEWS.renderLocaleButton('English', ENG_INDEX_HREF);
        }

        return WOLF_LOCALIZE_VIEWS.renderLocaleButton('Deutsch', DEU_INDEX_HREF);
    },

    localizeTitleHREF: function() {
        const href = this.currentLocaleIsGerman() ? DEU_INDEX_HREF : ENG_INDEX_HREF;
        WOLF_LOCALIZE_VIEWS.updateTitleHREF(href);
    },

    localizeSite: function () {
        this.localizeDesktopMenu();
        this.localizeMobileMenu();
        this.localizeLocaleButton();
        this.localizeTitleHREF();
    },

    bindToNavChanges: function () {
        var observer = new MutationObserver(this.localizeSite.bind(this));
        observer.observe(WOLF_LOCALIZE_VIEWS.getPrimaryNavNode(), {
            attributes: true, childList: true, characterData: true
        });
    },

    initialize: function () {
        this.localizeSite();
        this.bindToNavChanges();
    }
};

WOLF_LOCALIZE.initialize();
</script>